---
title: Harbor 实现双机互备
thumbnail: 'https://piccdn.freejishu.com/images/2019/08/01/PnYcXK.jpg'
abbrlink: 9d174858
date: 2019-08-02 09:55:53
tags:
categories:
---

*这是 六等星 的第 28 篇文章*



Harbor 实现主从备份可以实现主机向从机的自动镜像推送，实现自动备份，防止镜像丢失等问题 。



我们需要准备两台主机 ，在本文中用到的服务器如下 ：

```
192.168.43.173 Harbor-Host
192.168.43.174 Harbor-Bak
```

其中 173 作为主机 ，174 作为备份 。

两台主机需要实现搭好 Harbor 环境 ，Harbor的搭建可以参考我的文章 [Centos7 安装 Harbor](https://nightmare233.top/posts/bcbaf749.html) 。

安装好以后登录 Harbor Web 页面确保所有服务可用 。

SSH 连接上主机 192.168.43.173 ，使用 docker login 测试能否成功登陆 174 服务器 ，如果提示 Login Succeed ，那么可以直接在 Harbor Web 端操作实现主从备份了 。



#### 一 、新建目标连接

登录主机 173 的 Harbor ，在左侧 系统管理 --> 仓库管理 --> 新建目标  ：

- 提供者

  选择 Harbor 。

- 目标名

  推荐写一个简洁易懂的目标名 。

- 描述

  对目标的补充信息 ，可选项 。

- 目标 URL

  目标 Harbor 地址 。

- 访问 ID

  登录目标 Harbor 主机所使用的 ID 。

- 访问密码

  ID 对应的登录密码 。

- 验证远程证书

  在配置 HTTPS 的情况下启用 ，如果使用的是 HTTP 连接就别启用 ，会连接不上 。

配置完成后启用测试连接 ，测试连接通过就确定添加目标 ， 进行下一步 。



#### 二 、新建同步管理规则 

这一步在系统管理 --> 同步管理 --> 新建规则  ：

- 名称

  根据需要填写 。

- 描述

  同上 。

- 同步模式

  选择 Push-based ，即将 173 的资源推送给 174 。Pull-based 就是将 174 资源拉到 173 上 。

- 资源过滤器按照需求 

  过滤要同步的资源 ，可以根据文件名决定是否需要同步 。

- 目的 Registry 

  选择目标主机，这里选中 174 主机  。

- 目的 Namespace 

  你想要推送到的仓库目录名称 ，默认为空 ， 资源会被推送到同名目录下 。

- 触发模式

  分为 手动 、定时 、事件驱动三种 。手动是在有需要时手动备份 ，定时是在设定时间自动备份 ，事件驱动则是在有 Push 、Pull 实践时触发同步 ，可以理解为实时同步 。

- 删除本地资源时也删除远程的资源

  是否同步删除 。

- 覆盖

  在文件重复时是否用新的覆盖旧文件 。

- 启用规则

  规则是否立即启用 。

这样就配置好了，保存即会启用，向 173 传输的镜像会被自动同步到 174 服务器上 。

